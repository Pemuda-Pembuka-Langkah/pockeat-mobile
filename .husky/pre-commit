#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Skip commit message check in pre-commit hook
# We'll add it to prepare-commit-msg or commit-msg hooks instead
# For now let's focus on code quality checks

# Commit message validation skipped
echo "Running pre-commit checks on entire codebase..."

echo "\nğŸ” Step 1/5: Fixing lints automatically..."
echo "Applying dart fix to codebase..."
dart fix --apply lib
echo "âœ… Auto-fixes applied"

echo "\nğŸ” Step 2/5: Formatting code..."
if ! dart format lib; then
  echo "âŒ Formatting failed"
  exit 1
fi
echo "âœ… Formatting successful"

echo "\nğŸ” Step 3/5: Analyzing code..."
if ! dart analyze lib --fatal-infos --fatal-warnings; then
  echo "âŒ Analysis failed - Please fix remaining errors before committing"
  exit 1
fi
echo "âœ… Analysis successful"

echo "\nğŸ” Step 4/5: Sorting imports..."
if ! dart run import_sorter:main; then
  echo "âŒ Import sorting failed"
  exit 1
fi
echo "âœ… Import sorting successful"

echo "\nğŸ” Step 5/5: Running tests..."
if ! flutter test; then
  echo "âŒ Tests failed - Please fix failing tests before committing"
  exit 1
fi
echo "âœ… All tests passed"
